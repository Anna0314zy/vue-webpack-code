#  1.基础

## 1.概念

![WX20201123-091449@2x](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/WX20201123-091449@2x.png)

对比 [Node.js 模块](https://nodejs.org/api/modules.html)，webpack *模块*能够以各种方式表达它们的依赖关系，几个例子如下：

- [ES2015 `import`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import) 语句
- [CommonJS](http://www.commonjs.org/specs/modules/1.0/) `require()` 语句
- [AMD](https://github.com/amdjs/amdjs-api/blob/master/AMD.md) `define` 和 `require` 语句
- css/sass/less 文件中的 [`@import` 语句](https://developer.mozilla.org/en-US/docs/Web/CSS/@import)。
- 样式(`url(...)`)或 HTML 文件(`<img src=...>`)中的图片链接(image url)

mode

配置模式 启用webpack优化 三个选项

-  develompment
- production
- Node

![image-20201123102655278](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201123102655278.png)

![image-20201123141700047](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201123141700047.png)

## 2.webpack-dev-server

```js
devServer: {
    contentBase: path.resolve(__dirname, 'dist'), //产出文件的根目录
    port: 8080,
    host: 'localhost',
    compress: true
},
```

## 3.html-webpack-plugin

```js
plugins: [
    //产出html文件
    new HtmlWebpackPlugin({
        template: "./src/index.html",
        filename: 'index.html',
        hash: true, //为了避免缓存，可以在产出的文件后面加hash值
        //chunks: ['common', 'index'], //指定引入的代码块  用的不多 感觉不好使
        //chunksSortMode: "manual" //对引入的代码块进行排序的模式
    })
]
```

## 4.loader

![image-20201123151102639](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201123151102639.png)

![image-20201124105629691](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201124105629691.png)

logo 最后被打包成fd5生成的hash值

 把图片拷贝到dist目录 更改了文件名 文件名被打包成fd5生成的hash值 

![image-20201124111350686](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201124111350686.png)

![image-20201124112812808](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201124112812808.png)



![image-20201124112852995](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201124112852995.png)

打包后的结果

![image-20201124112655850](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201124112655850.png)

file-loader  把文件拷贝过去 改一下文件名 变更路径 相对路径

url-loader是file-loader的增强

有些时候 需要一些内联 有些文件比较小 不需要生成文件

```js
url-loader需要传参 options: {limit: 10*1024}
url-loader 内置了file-loader
加载的图片小于10k 就转换成base64编码 内嵌到网页中去
```

## 5.clean-webpack-plugin

npm install --save-dev clean-webpack-plugin

const { CleanWebpackPlugin } **=** require('clean-webpack-plugin');

```
 plugins: [
        /**
         * All files inside webpack's output.path directory will be removed once, but the
         * directory itself will not be. If using webpack 4+'s default configuration,
         * everything under <PROJECT_DIR>/dist/ will be removed.
         * Use cleanOnceBeforeBuildPatterns to override this behavior.
         *
         * During rebuilds, all webpack assets that are not used anymore
         * will be removed automatically.
         *
         * See `Options and Defaults` for information
         */
        new CleanWebpackPlugin(),
    ],
```

## 6.分离css

mini-css-extract-plugin

![image-20201124134329342](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201124134329342.png)

![image-20201124135644297](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201124135644297.png)

```js
plugins:[
   new MiniCssExtractPlugin({
            filename: '[name].css', //name 代码块chunk的名字
            chunkFilename: '[id].css' //代码块的名字 在异步加载的时候用的 分割代码块然后异步加载
        }) //分离css
]
```

## 7.压缩js css

![image-20201124141848252](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201124141848252.png)

uglifyjs-webpack-plugin  terser-webpack-plugin optimize-css-assets-webpack-plugin

## 8.css js存放单独的目录

![image-20201124152033069](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201124152033069.png)

![image-20201124152235549](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201124152235549.png)

![image-20201124152252568](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201124152252568.png)

hash代表本次的编译 每编译一次就会产生新的文件

chunkhash代码块的hash  每个entry都会产生一个chunk

```js
entry: {
  vendor: ['react', 'react-dom'],
  index: 'src/index.js'
}
output: {
  filename: '[name].[hash:8]js'
}
//产生2个chunk vendor index 
index.html 设置不缓存
index.js 设置hash值 文件名变了 就请求新的资源 不用缓存的
vendor.js --- 放到cdn 实现缓存
默认情况：index.js改变了  vendor也会跟着改变
现在我不想让vendor改变 
1.chunkhash
 new MiniCssExtractPlugin({
            filename: '[name][hash][chunkhash].css', //name 代码块chunk的名字
            //chunkhash 只要打包后的模块有一个发生了变化 都会改变
            chunkFilename: '[id].css' //代码块的名字 在异步加载的时候用的 分割代码块然后异步加载
        }) //分离css
2.contenthash
new MiniCssExtractPlugin({
            filename: '[name][contenthash].css', //name 代码块chunk的名字
            //chunkhash 只要打包后的模块有一个发生了变化 都会改变
            chunkFilename: '[id].css' //代码块的名字 在异步加载的时候用的 分割代码块然后异步加载
        }) //分离css
```

## 9.html使用src

![image-20201124163908363](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201124163908363.png)

webpack4使用html-withimg-loader遇到问题

问题：图片路径会有default
`ERROR in Error: Parse Error: <img src={"default":"389a66a25c539a9fd3524d58c43e2560.png"}> <script type="text/javascript" src="bundle.js?588181ceb9662c845b90"></script></body> </html>`

解决方案：
file-loader升级以后，esModule参数默认为true，改为false即可

```javascript
{
                test: /\.(png|jpg|gif)$/,
                use: [
                    {
                        loader: 'file-loader',
                        options: {
                            esModule: false,
                            outputPath: 'assets'
                        },
                    },
                ],
            }
```

## 10.glob

![image-20201124195943303](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201124195943303.png)

![image-20201124200036995](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201124200036995.png)

## 11.less sass

```js
 {
                test: /\.less$/,
                // use: 'css-loader', //单个
                // 不用style-loader
                use: [MiniCssExtractPlugin.loader, 'css-loader', 'less-loader'] //从右向左
            },
            {
                test: /\.scss$/,
                // use: 'css-loader', //单个
                // 不用style-loader
                use: [MiniCssExtractPlugin.loader, 'css-loader','sass-loader'] //从右向左
            },
              
 //在css-loader 里使用less
               {
                test: /\.css$/,
                // use: 'css-loader', //单个
                // 不用style-loader
                use: [
                    MiniCssExtractPlugin.loader,
                    {
                        loader: 'css-loader',
                        options:{
                            importLoaders: 2
                             //0 no loader
                             //1 postcss-loader
                              //2 postcss-loader sass-loader
                             }
                    },
                        'postcss-loader',
                         'sass-loader'
                ] //从右向左
```



## 12.处理css前缀

![image-20201124201951655](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201124201951655.png)

```js
{
                test: /\.css$/,
                // use: 'css-loader', //单个
                // 不用style-loader
                use: [MiniCssExtractPlugin.loader, 'css-loader', 'postcss-loader'] //从右向左
            },
```

```js
postcss.config.js 默认文件名
module.exports = {
    plugins: [require('autoprefixer')]
}
.browserslistrc 配置的支持浏览器版本
# Browsers that we support

last 1 version
> 1%
maintained node versions
not dead
IE 6 # sorry

```

## 13.转译es6/es7

![image-20201124204437181](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201124204437181.png)

 ```js
{
  "presets":[
    "@babel/preset-env",
    "@babel/preset-react"
  ],
  "plugins":[
    ["@babel/plugin-proposal-decorators", { "legacy": true }], //旧的写法
    [ "@babel/plugin-proposal-class-properties",{"loose": true}], //松散的模式
    ["@babel/plugin-transform-runtime", {
      "corejs": false,
      "helpers": true,
      "regenerator": true,
      "useESModules": true
    }]
  ]
}

 ```



## 14.babel-run-time

![image-20201124221311194](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201124221311194.png)

申明类的时候 每个类都引用了共同的方法

![image-20201124224119600](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201124224119600.png)

## 15.eslint

![image-20201125105707543](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201125105707543.png)

![image-20201125112215194](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201125112215194.png)

npm i eslint-config-airbnb eslint-plugin-import eslint-plugin-react eslint-plugin-react-hooks eslint-plugin-jsx-a11y -D

## 16.引入字体

![image-20201125114004106](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201125114004106.png)

![image-20201125114021130](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201125114021130.png)

## 17.如何调试

![image-20201125115104696](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201125115104696.png)

Webstorm配置 https://www.it610.com/article/1281976568083660800.htm

![image-20201126203500931](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201126203500931.png)

Cheap-module-source-map 源码不能调整列

eval 最快  不能调整源码  线上不能使用

----测试服务器 才能上传sourcr-map

![image-20201126232528614](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201126232528614.png)

![image-20201127113539653](/Users/zouyu/Desktop/react-zy/img/image-20201127113539653.png)

安装compiler.jar

执行上述命令 ----

可以看一下网站了解

![image-20201127212815895](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201127212815895.png)

## 18.第三方库

![image-20201127220029264](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201127220029264.png)

```js
1. {
        test: require.resolve('jquery'),
        use: [{
          loader: 'expose-loader',
          options: '$'
        }]
      }

2. require("expose-loader?$!jquery");
暴露成全局变量 window.$ 也可以有

3. webpack
--externals
 externals: {
     'jquery': 'jQuery' //key是包的名字，值是jQuery 全局上的jQuery给了jquery
  },
    需要去index.html去手动添加cdn地址
4.利用插件 插件去帮我们自动写script标签
 new htmlWebpackExternalsPlugin({
      externals: [
        {
          module: 'jquery',
          entry: 'https://unpkg.com/jquery@3.2.1/dist/jquery.min.js',
          global: 'jQuery',
        },
      ],
    }),
```

## 19.watch

![image-20201127234716819](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201127234716819.png)

## 20.添加商标-拷贝静态文件

![image-20201127235102896](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201127235102896.png)

## 21服务器代理

![image-20201127235348842](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201127235348842.png)

```js
devServer: {
    contentBase: path.resolve(__dirname, 'dist'), // 产出文件的根目录
    port: 8080,
    host: 'localhost',
    compress: true,
      //dev-server内部就是一个express
      before() {
      app.get('/api/users', function(req,res) => {
              res.json([{}])
              })
    },
    proxy: {
      '/api':{ /api/users  ===>后台接口其实是/users
        target: 'http://localhost:3000',
        pathRewrite: ["^/api", ""]
      }
    },
}
```

## 22.webpack-dev-middleware

在node项目中集成一个webpack

```js
let express = require('express');
let app = express();
let webpackDevMiddleware = require('webpack-dev-middleware');
let webpackConfig = require('./webpack.config.js');
let webpack = require('webpack');
let compiler = webpack(webpackConfig);
//中间件到底做了什么?
/**
 * 1.启动编译 compiler.run
 * 2.有一个中间件 用来响应客户端对打包后的文件的请求
 */
app.use(webpackDevMiddleware(compiler, {}));
app.get('/users', function (req, res) {
  res.json([{id:1, name: 'zhufeng'}])
})
app.listen('3000')
//访问localhose:3000 能拿到客户端资源 没有跨域问题 可以直接上线
```

![image-20201128143144951](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201128143144951.png)

## 23.reslove

```js
  //定制一些查找文件的规则
  resolve: {
    extensions: ['.js','.jsx', '.vue', '.scss','.less', '.css'],
    alias:{
      //引入的时候 直接找你指定的路径 就不从按照node_modules规则找了
      'bootstrap': path.join(__dirname, 'node_modules/bootstrap/dist/css/bootstrap.css'),
    },
    //可以减少查找的路径 加快查找速度 可以自己添加查找路径
    modules: ['node_modules', 'zfmodules'],// 先从node_modules里面找 找不到 再找zfmath
    mainFields: ['style', 'browser', 'module', 'main'],
    mainFiles: ['base.js', 'index.js']
  }
```

 ![image-20201128145732625](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201128145732625.png)

mainFiles

![image-20201128160813210](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201128160813210.png)

![image-20201128162629282](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201128162629282.png)

## 24.noParse

![image-20201128162823863](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201128162823863.png)

## 25.definePlugin

![image-20201128163201919](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201128163201919.png)

会把这些变量和值挂载到全局上

## 26.IgnorePlugin

![image-20201128164048416](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201128164048416.png)

```js
//设置语言

//手动引入所需要的语言包
import 'moment/locale/zh-cn';

moment.locale('zh-cn');

let r = moment().endOf('day').fromNow();
console.log(r);
```

## 27.区分环境变量

![image-20201128164744840](/Users/zouyu/Desktop/vue-webpack-code/webpack-dev/img/image-20201128164744840.png)

```js
package.json
  "scripts": {
    "build": "webpack",
    "build:dev": "webpack --env=development",
    "build:prod": "webpack --env=production",
  },
    可以传参
    webpack.config.js
    module.expoets = (env, argv) {
      mode: env
    }
    封装log
    let oldConsole = console.log
    console.log = function(...args) {
     
      if (process.env.NODE_ENV === 'development') {
         oldConsole.apply(console, args);
      }
    }
```

![image-20201128170718250](/Users/zouyu/Library/Application Support/typora-user-images/image-20201128170718250.png)